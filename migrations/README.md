# ğŸ“š EasyPeek æ–°é—»ç³»ç»Ÿæ•°æ®åº“è¿ç§»æŒ‡å—

## ğŸ¯ è¿ç§»è„šæœ¬è¯´æ˜

### æ–‡ä»¶ç»“æ„
```
migrations/
â”œâ”€â”€ 001_create_news_tables.sql    # åˆ›å»ºæ–°é—»è¡¨ç»“æ„
â”œâ”€â”€ 001_rollback_news_tables.sql  # å›æ»šè„šæœ¬ï¼ˆåˆ é™¤æ‰€æœ‰æ–°é—»è¡¨ï¼‰
â””â”€â”€ README.md                     # æœ¬ä½¿ç”¨è¯´æ˜
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šé€šè¿‡psqlå‘½ä»¤è¡Œæ‰§è¡Œ
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd d:\EasyPeek\EasyPeek-backend

# æ‰§è¡Œè¿ç§»è„šæœ¬
psql -h localhost -U your_username -d easypeek_db -f migrations/001_create_news_tables.sql

# å¦‚éœ€å›æ»šï¼ˆè°¨æ…ï¼ï¼‰
psql -h localhost -U your_username -d easypeek_db -f migrations/001_rollback_news_tables.sql
```

### æ–¹æ³•äºŒï¼šé€šè¿‡æ•°æ®åº“ç®¡ç†å·¥å…·
1. æ‰“å¼€pgAdminã€DBeaveræˆ–å…¶ä»–æ•°æ®åº“å·¥å…·
2. è¿æ¥åˆ°EasyPeekæ•°æ®åº“
3. æ‰“å¼€å¹¶æ‰§è¡Œ `001_create_news_tables.sql` æ–‡ä»¶å†…å®¹

### æ–¹æ³•ä¸‰ï¼šé€šè¿‡Goä»£ç æ‰§è¡Œï¼ˆæ¨èåä½œï¼‰
```go
// åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º cmd/migrate/main.go
package main

import (
    "io/ioutil"
    "log"
    "github.com/EasyPeek/EasyPeek-backend/internal/config"
    "github.com/EasyPeek/EasyPeek-backend/internal/database"
)

func main() {
    // åŠ è½½é…ç½®
    cfg, err := config.LoadConfig("internal/config/config.yaml")
    if err != nil {
        log.Fatal(err)
    }

    // åˆå§‹åŒ–æ•°æ®åº“
    if err := database.Initialize(cfg); err != nil {
        log.Fatal(err)
    }
    defer database.CloseDatabase()

    // è¯»å–å¹¶æ‰§è¡Œè¿ç§»è„šæœ¬
    sqlContent, err := ioutil.ReadFile("migrations/001_create_news_tables.sql")
    if err != nil {
        log.Fatal(err)
    }

    db := database.GetDB()
    if err := db.Exec(string(sqlContent)).Error; err != nil {
        log.Fatal("Migration failed:", err)
    }

    log.Println("Migration completed successfully!")
}
```

## ğŸ“Š è¿ç§»å†…å®¹è¯¦è§£

### 1. è¡¨ç»“æ„
- **rss_sources**: RSSæºç®¡ç†è¡¨
- **news**: æ–°é—»ä¸»è¡¨
- **event_news_relations**: äº‹ä»¶-æ–°é—»å…³è”è¡¨

### 2. ç´¢å¼•ä¼˜åŒ–
- å•å­—æ®µç´¢å¼•ï¼šæå‡å¸¸ç”¨å­—æ®µæŸ¥è¯¢æ€§èƒ½
- å¤åˆç´¢å¼•ï¼šä¼˜åŒ–æ’åºå’Œå¤šæ¡ä»¶æŸ¥è¯¢
- å”¯ä¸€ç´¢å¼•ï¼šç¡®ä¿æ•°æ®å”¯ä¸€æ€§

### 3. è‡ªåŠ¨åŒ–åŠŸèƒ½
- **çƒ­åº¦è®¡ç®—å‡½æ•°**: è‡ªåŠ¨è®¡ç®—æ–°é—»çƒ­åº¦åˆ†å€¼
- **æ›´æ–°è§¦å‘å™¨**: ç»Ÿè®¡æ•°æ®å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°çƒ­åº¦
- **ç»Ÿè®¡è§†å›¾**: ä¾¿äºæ•°æ®åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆ

### 4. ç¤ºä¾‹æ•°æ®
- 5ä¸ªå¸¸ç”¨RSSæº
- 3æ¡ç¤ºä¾‹æ–°é—»
- è‡ªåŠ¨è®¡ç®—çš„çƒ­åº¦åˆ†å€¼

## âš ï¸ æ³¨æ„äº‹é¡¹

### åä½œè€…åŒæ­¥æ­¥éª¤
1. **æ‹‰å–æœ€æ–°ä»£ç **: `git pull origin main`
2. **æ‰§è¡Œè¿ç§»è„šæœ¬**: è¿è¡Œä¸Šè¿°ä»»ä¸€æ–¹æ³•
3. **éªŒè¯ç»“æœ**: æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
4. **å¯åŠ¨é¡¹ç›®**: ç¡®ä¿ç¨‹åºæ­£å¸¸è¿è¡Œ

### æ•°æ®å®‰å…¨
- âœ… è¿ç§»å‰è¯·å¤‡ä»½ç°æœ‰æ•°æ®
- âœ… åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯è„šæœ¬
- âš ï¸ å›æ»šè„šæœ¬ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®
- âš ï¸ ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œå‰è¯·ä¸‰æ€

### å¸¸è§é—®é¢˜
1. **æƒé™é—®é¢˜**: ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰åˆ›å»ºè¡¨çš„æƒé™
2. **ä¾èµ–è¡¨ç¼ºå¤±**: ç¡®ä¿userså’Œeventsè¡¨å·²å­˜åœ¨
3. **é‡å¤æ‰§è¡Œ**: è„šæœ¬ä½¿ç”¨IF NOT EXISTSï¼Œå¯å®‰å…¨é‡å¤æ‰§è¡Œ

## ğŸ” éªŒè¯è¿ç§»æˆåŠŸ

### æ£€æŸ¥è¡¨ç»“æ„
```sql
-- æŸ¥çœ‹åˆ›å»ºçš„è¡¨
\dt

-- æŸ¥çœ‹è¡¨ç»“æ„
\d rss_sources
\d news
\d event_news_relations
```

### æ£€æŸ¥åŠŸèƒ½
```sql
-- æŸ¥çœ‹ç¤ºä¾‹æ•°æ®
SELECT * FROM news LIMIT 5;

-- æµ‹è¯•çƒ­åº¦è®¡ç®—å‡½æ•°
SELECT calculate_news_hotness(1000, 50, 10, 5, NOW() - INTERVAL '2 hours');

-- æŸ¥çœ‹ç»Ÿè®¡è§†å›¾
SELECT * FROM news_stats_summary;
```

### æ£€æŸ¥Goæ¨¡å‹åŒæ­¥
```bash
# é‡æ–°ç¼–è¯‘é¡¹ç›®
go build ./cmd/

# è¿è¡Œé¡¹ç›®ç¡®ä¿æ¨¡å‹åŒ¹é…
go run ./cmd/main.go
```

## ğŸ¤ å›¢é˜Ÿåä½œå»ºè®®

1. **ç»Ÿä¸€è¿ç§»**: æ‰€æœ‰å›¢é˜Ÿæˆå‘˜åº”ä½¿ç”¨ç›¸åŒçš„è¿ç§»è„šæœ¬
2. **ç‰ˆæœ¬æ§åˆ¶**: è¿ç§»è„šæœ¬çº³å…¥Gitç‰ˆæœ¬æ§åˆ¶
3. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°APIæ–‡æ¡£å’Œæ•°æ®å­—å…¸
4. **æµ‹è¯•è¦†ç›–**: ä¸ºæ–°åŠŸèƒ½ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## ğŸ“ é‡åˆ°é—®é¢˜ï¼Ÿ

å¦‚æœåœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œæƒé™
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ç¡®å®šå…·ä½“é—®é¢˜
3. å‚è€ƒæœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
4. è”ç³»é¡¹ç›®ç»´æŠ¤è€…è·å¾—å¸®åŠ©
